var attachnum = $attachnum;
var pid = $pid;

window.UEDITOR_HOME_URL = "$conf[plugin_url]baidu_editor/ueditor/";
$.xload('plugin/baidu_editor/ueditor/ueditor.config.js', 'plugin/baidu_editor/ueditor/ueditor.all.js', 'view/js/editor/swfupload.js', function() {
	var editor = new UE.ui.Editor();
	window.editor = editor;
	editor.render("post_message_$pid");
	editor.ready(function(){
		editor.setContent($('#post_message_$pid').val());
		editor.focus();
		//alert($('#file_upload_'+pid).html());
		//var attachdialog = editor.ui._dialogs.attachmentDialog;
		
		var attachdialog = editor.getDialog('attachment');
		attachdialog.iframeUrl = '?ueditor-attach-fid-$fid-pid-$pid-redirect-0.htm';
		
		attachdialog.onok = function() {
			$('#'+attachdialog.id+'_iframe')[0].contentWindow.attach_form_submit(attachdialog);
			return false;
		};
		
		//attachdialog.open();
		//attachdialog.mesureSize();
		//attachdialog.getDom('content').innerHTML = 'xxxxxxxxxxxxxxqqq';
		//attachdialog.close();
		
		window.set_attach_num = function(attachnum) {
			if(attachnum > 0) {
				$('#'+editor.ui.id).find('div.edui-for-attachment').alert(attachnum, {alerticon: 0, width: 20});
			}
		};
		window.set_attach_num(attachnum);
	});
});